<div class="container">
  <mat-card>
    <mat-card-title>Products</mat-card-title>
    <mat-card-content>
      <div *ngIf="isLoading">
        <mat-spinner></mat-spinner>
        <p>Loading products...</p>
      </div>

      <div *ngIf="errorMessage" class="error">
        {{ errorMessage }}
      </div>

      <div class="products-container" *ngIf="!isLoading && !errorMessage && products.length > 0">
        <mat-accordion class="product-accordion" *ngFor="let product of products">
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title class="product-header">
                <img
                  *ngIf="mainImageUrls[product.id!]"
                  class="product-image"
                  ngSrc="{{ mainImageUrls[product.id!] }}"
                  alt="{{ product.name }} image"
                  width="60"
                  height="60"
                />
                <h3>{{ product.name }}</h3>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="product-details">
              <p>{{ product.description }}</p>
              <p>Price: {{ product.price | currency }}</p>
              <mat-form-field>
                <mat-label>Staff</mat-label>
                <mat-select [(ngModel)]="selectedStaffId[product.id!]">
                  <mat-option *ngFor="let staff of staffList" [value]="staff.id">
                    {{ staff.firstName }} {{ staff.lastName }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field>
                <mat-label>Select Customer</mat-label>
                <mat-select [(ngModel)]="selectedCustomerId[product.id!]">
                  <mat-option *ngFor="let customer of customers" [value]="customer.id">
                    {{ customer.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field>
                <mat-label>Price</mat-label>
                <input
                  matInput
                  type="number"
                  [ngModel]="enteredPrice[product.id!]"
                  (ngModelChange)="onPriceChange($event, product.id!)"
                  min="0"
                  name="price_{{product.id}}"
                />
              </mat-form-field>
              <button mat-button (click)="bookWash(product.id!)">Book Wash</button>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>

      <mat-paginator
        *ngIf="!isLoading && !errorMessage && products.length > 0"
        [length]="totalCount"
        [pageSize]="pageSize"
        [pageIndex]="pageIndex"
        [pageSizeOptions]="[4, 8, 12, 20]"
        (page)="handlePageEvent($event)"
        aria-label="Select page"
      >
      </mat-paginator>

      <div *ngIf="!isLoading && !errorMessage && products.length === 0">
        <p>No products found.</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>